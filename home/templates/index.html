<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container mt-5">
        <h1 class="text-center">To-Do List</h1>

        <!-- Form for adding new to-do -->
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">Add New Task</h5>
                <form id="todoForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">Task Title</label>
                        <input type="text" class="form-control" id="title" placeholder="Task title" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Task Description</label>
                        <textarea class="form-control" id="description" rows="3" placeholder="Task description"
                            required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Task</button>
                </form>
            </div>
        </div>

        <!-- List of tasks -->
        <div class="mt-5">
            <h3>Task List</h3>
            <ul id="todoList" class="list-group">
                <!-- Tasks will be added here dynamically -->
            </ul>
        </div>
    </div>

    <script>
        var wsProtocol = (window.location.protocol === 'https:') ? 'https://' : 'http://';
        const API_URL = wsProtocol + window.location.host + '/api/todos/';

        // Function to fetch and display all tasks
        function fetchTodos() {
            fetch(API_URL)
                .then(response => response.json())
                .then(todos => {
                    const todoList = document.getElementById('todoList');
                    todoList.innerHTML = '';  // Clear current list
                    todos.forEach(todo => {
                        const completedClass = todo.completed ? 'text-decoration-line-through' : ''; // Strike-through if completed
                        const checked = todo.completed ? 'checked' : ''; // Checkbox checked if completed

                        const listItem = document.createElement('li');
                        listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');
                        listItem.innerHTML = `
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="check${todo.id}" ${checked} onchange="toggleComplete(${todo.id})">
                                <label class="form-check-label ${completedClass}" for="check${todo.id}">
                                    <h5>${todo.title}</h5>
                                    <p>${todo.description}</p>
                                </label>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-warning me-2" onclick="editTask(${todo.id})">Edit</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteTask(${todo.id})">Delete</button>
                            </div>
                        `;
                        todoList.appendChild(listItem);
                    });
                });
        }

        // Function to toggle task completion
        function toggleComplete(id) {
            const checkbox = document.getElementById(`check${id}`);
            const isCompleted = checkbox.checked;
            const title = checkbox.closest('li').querySelector('h5').innerText;
            const description = checkbox.closest('li').querySelector('p').innerText;

            fetch(API_URL + id + '/', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: title, description: description, completed: isCompleted })
            }).then(() => fetchTodos());
        }

        // Function to add a new task
        document.getElementById('todoForm').addEventListener('submit', function (event) {
            event.preventDefault();  // Prevent form submission

            const newTodo = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                completed: false
            };

            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newTodo)
            }).then(() => {
                document.getElementById('title').value = '';  // Clear form
                document.getElementById('description').value = '';
                fetchTodos();
            });
        });

        // Function to delete a task
        function deleteTask(id) {
            fetch(API_URL + id + '/', {
                method: 'DELETE'
            }).then(() => fetchTodos());
        }

        // Function to edit a task
        function editTask(id) {
            const newTitle = prompt("Edit title:");
            const newDescription = prompt("Edit description:");

            if (newTitle && newDescription) {
                fetch(API_URL + id + '/', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: newTitle, description: newDescription, completed: false })
                }).then(() => fetchTodos());
            }
        }

        // Initial fetch of tasks when page loads
        document.addEventListener('DOMContentLoaded', function () {
            fetchTodos();
        });
    </script>

</body>

</html>
